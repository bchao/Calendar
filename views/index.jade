extends layout

block content
  div(ng-app="calendarApp")
    if (user)
      p You are currently logged in as #{user.name}
    else
      p You are currently not logged in. Plaese login or register...
    br

    link(rel='stylesheet', href='/css/calendar.min.css')
    link(rel='stylesheet', href='/css/angular-csp.css')

    br
    .page-header
      .pull-right.form-inline
        .btn-group
          button.btn.btn-primary(ng-click="navigate('prev');") << Prev
          button.btn(ng-click="navigate('today');") Today
          button.btn.btn-primary(ng-click="navigate('next');") Next >>
        .btn-group#viewLengthButtons
          button.btn.btn-warning(calendarView="year", ng-click="setViewLength('year');") Year
          button.btn.btn-warning.active(calendarView="month", ng-click="setViewLength('month');") Month
          button.btn.btn-warning(calendarView="week", ng-click="setViewLength('week');") Week
          button.btn.btn-warning(calendarView="day", ng-click="setViewLength('day');") Day
      h3
      br
    .row
      .span9
        #calendar
      .span3
        #sideBar(ng-controller="sideBarController")
          .btn-group
            button.btn.btn-primary(ng-click="displayUserGroups()") User Groups
            button.btn.btn-primary(ng-click="displayCalendars()") Calendars
            button.btn.btn-primary(ng-click="displayEvents()") Events
          h3 {{ title }}
          #userGroupWindow(ng-show="selector == 0")
            ul
              li(ng-repeat="group in userGroups")
                a(href, ng-click="displayUserGroup(group)") {{ group.name + " " }}
                a(href, ng-click="deleteUserGroup(group._id)") [X]
            form(name="createGroupForm")
              input(type="text", ng-model="inputUserGroup", required)
              button.btn.btn-primary(ng-disabled="createGroupForm.$invalid", ng-click="createGroup()") Create Group
          #userListWindow(ng-show="selector == 1")
            ul
              li(ng-repeat="user in selectedUserGroup.users")
                {{ user.name + " " }}
                a(href, ng-click="deleteUserFromGroup(user.email)") [X]
            form(name="addUserForm")
              input(type="text", ng-model="inputUserEmail", required)
              button.btn.btn-primary(ng-disabled="addUserForm.$invalid", ng-click="addUserToGroup()", ) Add User
              {{ text }}

          #calendarInfo(ng-show="selector == 2")
            |Owner
            ul
              li(ng-repeat="calendar in myCalendars")
                a(href, ng-click="displayCalendar(calendar)") {{ calendar.name }}
                a(href, ng-click="deleteCalendar(calendar._id)") [X]
            |Modify
            ul
              li(ng-repeat="calendar in modCalendars")
                a(href, ng-click="displayCalendar(calendar)") {{ calendar.name }}
            |See All
            ul
              li(ng-repeat="calendar in viewCalendars")
                a(href, ng-click="displayCalendar(calendar)") {{ calendar.name }}
            |Busy Only
            ul
              li(ng-repeat="calendar in viewBusyCalendars")
                a(href, ng-click="displayCalendar(calendar)") {{ calendar.name }}
            form(name="createCalendarForm")
              input(type="text", ng-model="inputCalendarName", required)
              button.btn.btn-primary(ng-disabled="createCalendarForm.$invalid", ng-click="createCalendar(inputCalendarName)") Create Calendar

          #calendarEvents(ng-show="selector == 4")
            |Events
            ul
              li(ng-repeat="event in localEvents")
                a(href ng-click="displayEventDetails(event)") {{ event.name }}
    br
    .span9
      #bottomBar(ng-controller="bottomAreaController")
        #displayEvent(ng-show="bottomSelector == 0")
          h3 {{ selectedEvent.name }}
          h1 Description
          p {{ selectedEvent.details }}
          h1 At
          p {{ selectedEvent.location }}
          h1 From
          p {{ selectedEvent.start }}
          h1 To
          p {{ selectedEvent.end }}
          div(ng-show="selectedEvent.alerts")
            h1 Alerts
            ul
              li(ng-repeat="alert in selectedEvent.alerts") {{ alert }}
          h1 Repeats?
          p {{ selectedEvent.willRepeat }}
            div(ng-show="selectedEvent.willRepeat")
              p(ng-show="eventDetails.repeatMode == 'Number'") Repeats for {{ eventDetails.repeatCount }} iterations.
              p(ng-show="eventDetails.repeatMode == 'End Date'") Repeats until {{ eventDetails.repeatUntil }}.
          h1 Calendar
          p {{ selectedEvent.calendar.name }}

        #createEvent(ng-show="bottomSelector == 1")
          form(name="eventForm")
            label Event Name
            input(type="text", ng-model="eventDetails.name", placeholder="Event Name", required)

            label Description
            textarea(rows="10", cols="50", ng-model="eventDetails.description", placeholder="Description")

            label Location
            input(type="text", ng-model="eventDetails.location", placeholder="Location")
            //
              label All Day?
              input(type="checkbox", ng-model="eventDetails.isAllDay")

            label Start Time
            input(type="datetime-local", ng-model="eventDetails.start", placeholder="yyyy-MM-ddTHH:mm", min="2015-01-01T00:00" max="2050-12-31T00:00", required)
            
            label End Time
            input(type="datetime-local", ng-model="eventDetails.end", placeholder="yyyy-MM-ddTHH:mm", min="2015-01-01T00:00" max="2050-12-31T00:00", required)

            //Currently this naively assumes the date in alertTime is valid
            label Add Alert
            input(type="datetime-local", ng-model="alertTime", placeholder="yyyy-MM-ddTHH:mm", min="2015-01-01T00:00" max="2050-12-31T00:00")
            br
            button.btn(type="button", ng-click="addAlert()") Add Alert
            ul
             li(ng-repeat="time in eventDetails.alerts") {{ time.toLocaleTimeString() + "  " }}
               a(href ng-click="removeAlert(time)") [X]
            
            label Repeat?
            input(type="checkbox", ng-model="eventDetails.willRepeat")
            div(ng-hide="!eventDetails.willRepeat")
              label Repeat Mode
              select(ng-model="eventDetails.repeatMode", placeholder="Select an Option")
                option Number
                option End Date
              div(ng-hide="eventDetails.repeatMode != 'Number'")
                label Repeat Count
                input(type="text", ng-model="eventDetails.repeatCount", placeholder="Enter an Integer", ng-pattern="/[0-9]+/")
              div(ng-hide="eventDetails.repeatMode != 'End Date'")
                label End Date
                input(type="date", ng-model="eventDetails.repeatUntil", placeholder="yyyy-MM-dd")
            label Containing Calendar
            select(ng-model="eventDetails.calendar", ng-options="calendar.name group by calendar.grouping for calendar in calendars | filter:{grouping: '!Busy Calendar'} | filter:{grouping: '!Viewable Calendar'}", required)
            br
            btn.btn.btn-primary(ng-disabled="eventForm.$invalid", ng-click="sendEventData()") Save
            br
          br
          |{{ text }}
    script(type='text/javascript', src='/js/underscore-min.js')
    script(type='text/javascript', src='/js/calendar.min.js')
    script(type='text/javascript', src='/js/angular.js')
    script(type='text/javascript', src='/js/index.js')
    script(type='text/javascript', src='/js/bottomAreaController.js')
    script(type='text/javascript', src='/js/sideBarController.js')
